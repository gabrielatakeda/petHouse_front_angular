<div class="container">
  <h2>Gerenciamento de Categorias</h2>

  <!-- Botão para exibir opções -->
  <button class="btn-subcategoria" (click)="onCadastrarClick()">Cadastrar</button>

  <!-- Exibe opções de cadastro -->
  @if (showCadastro()) {
    <div style="margin-top: 1rem;">
      <label for="tipoCadastro">Escolha o tipo de cadastro:</label>
      <select id="tipoCadastro" class="form-control" (change)="onTipoChange($event)">
        <option value="">Selecione...</option>
        <option value="categoria">Categoria</option>
        <option value="subcategoria">Subcategoria</option>
      </select>
    </div>
  }

  <!-- Formulário de Categoria -->
  @if (tipoCadastro() === 'categoria') {
    <div class="card mt-3 p-3">
      <h4>Cadastrar Categoria</h4>
      <form [formGroup]="categoriaForm" (ngSubmit)="salvarCategoria()">
        <label for="nome">Nome da Categoria:</label>
        <input id="nome" type="text" formControlName="nome" class="form-control" required>

        <button type="submit" class="btn-subcategoria mt-3">Salvar Categoria</button>
      </form>
    </div>
  }

  <!-- Formulário de Subcategoria -->
  @if (tipoCadastro() === 'subcategoria') {
    <div class="card mt-3 p-3">
      <h4>Cadastrar Subcategoria</h4>
      <form [formGroup]="subcategoriaForm" (ngSubmit)="salvarSubcategoria()">
        <label for="categoriaPai">Categoria Pai:</label>
        <select id="categoriaPai" formControlName="categoriaPai" class="form-control" required>
          <option value="">Selecione...</option>
          
          @for (cat of categoriasPai; track cat.slug) {
            <option [value]="cat.slug">{{ cat.nome }}</option>
          }
        </select>

        <label for="nomeSubcategoria" class="mt-2">Nome da Subcategoria:</label>
        <input id="nomeSubcategoria" type="text" formControlName="nomeSubcategoria" class="form-control" required>

        <button type="submit" class="btn-subcategoria mt-3">Salvar Subcategoria</button>
      </form>
    </div>
  }
</div>

<div class="top-products">
    <h3>Categorias</h3>
    <table>
        <thead>
                <tr>
                    <th>ID</th>
                    <th>Nome</th>
                    <th>Subcategorias</th>
                </tr>
        </thead>

        <tbody>
            @for (categoria of categoriasPai; track $index) {
            <tr>
                <td>{{ categoria.id }}</td>
                <td>{{ categoria.nome }}</td>
                <td>
                    <button class="btn-subcategoria" (click)="findSubcategorias(categoria.id!)">Subcategorias</button>
                </td>
            </tr>
            }
        </tbody>
    </table>
</div>


@if (subcategorias.length > 0) {
<div class="top-products">
    <h3>Subcategorias da categoria {{ categoriaSelecionadaId }}</h3>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
            </tr>
        </thead>

        <tbody>
            @for (sub of subcategorias; track $index) {
            <tr>
                <td>{{ sub.id }}</td>
                <td>{{ sub.nome }}</td>
            </tr>
            }
        </tbody>
    </table>
</div>
}